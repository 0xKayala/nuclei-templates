id: CVE-2024-6387

info:
  name: OpenSSH regreSSHion Vulnerability (CVE-2024-6387)
  author: 0xKayala
  severity: high
  description: |
    A security regression (CVE-2006-5051) was discovered in OpenSSH's server (sshd). There is a race condition which can lead to sshd to handle some signals in an unsafe manner. An unauthenticated, remote attacker may be able to trigger it by failing to authenticate within a set time period. This template checks for CVE-2024-6387 Vulnerability in OpenSSH servers.
  impact: This vulnerability, if exploited, could lead to full system compromise where an attacker can execute arbitrary code with the highest privileges, resulting in a complete system takeover, installation of malware, data manipulation, and the creation of backdoors for persistent access. It could facilitate network propagation, allowing attackers to use a compromised system as a foothold to traverse and exploit other vulnerable systems within the organization.
  reference: 
    - https://blog.qualys.com/vulnerabilities-threat-research/2024/07/01/regresshion-remote-unauthenticated-code-execution-vulnerability-in-openssh-server
    - https://nvd.nist.gov/vuln/detail/CVE-2024-6387
    - https://github.com/filipi86/CVE-2024-6387-Vulnerability-Checker

tcp:
  - inputs:
      - data: "\r\n"
    host:
      - "{{Hostname}}"
    port: 22
    read-size: 1024

    matchers-condition: and
    matchers:
      - type: regex
        name: vulnerable-versions
        regex:
          - "SSH-2.0-OpenSSH_(1|2|3|4\\.[0-4]|8\\.[5-9]|9\\.[0-7])\\b"
        part: data
      - type: regex
        name: patched-versions
        negative: true
        regex:
          - "SSH-2.0-OpenSSH_8\\.9p1 Ubuntu-3ubuntu0\\.10"
          - "SSH-2.0-OpenSSH_9\\.3p1 Ubuntu-3ubuntu3\\.6"
          - "SSH-2.0-OpenSSH_9\\.6p1 Ubuntu-3ubuntu13\\.3"
          - "SSH-2.0-OpenSSH_9\\.3p1 Ubuntu-1ubuntu3\\.6"
          - "SSH-2.0-OpenSSH_9\\.2p1 Debian-2\\+deb12u3"
          - "SSH-2.0-OpenSSH_8\\.4p1 Debian-5\\+deb11u3"
          - "SSH-2.0-OpenSSH_9\\.7p1 Debian-7"
        part: data
